<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Modern Property Sales Data Table</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.5/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/select/2.0.0/css/select.bootstrap5.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.5/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.5/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/select/2.0.0/js/dataTables.select.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        body { padding: 20px; font-family: 'Roboto', sans-serif; background-color: #f4f7fa; }
        .filter-section { margin-bottom: 20px; }
        table.dataTable thead th { background-color: #007bff; color: white; }
        .table-striped > tbody > tr:nth-of-type(odd) { background-color: rgba(0,123,255,.05); }
        .table-striped > tbody > tr:hover { background-color: rgba(0,123,255,.2); }
        .container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h2 { font-weight: 700; }
    </style>
</head>
<body>

<div class="container">
    <h2 class="mb-4 text-center">Property Sales Data</h2>

    <div class="filter-section row" id="filters"></div>

    <table id="salesTable" class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Property Class</th>
                <th>Sale Date</th>
                <th>Sale Price</th>
                <th>SqFt</th>
                <th>Price/SqFt</th>
                <th>Price Time Adj</th>
                <th>Style</th>
                <th>Year Built</th>
                <th>Acreage</th>
                <th>Bedrooms</th>
                <th>Baths</th>
            </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
            <tr>
                <td colspan="11" class="text-center">Rows Showing: <span id="rowCount"></span> | Average Sale Price: $<span id="avgPrice"></span></td>
            </tr>
        </tfoot>
    </table>
</div>

<script>
$(document).ready(function() {
    const table = $('#salesTable').DataTable({ dom: 'lrtip' });

    function loadCSVData() {
        Papa.parse("sales_data.csv", {
            download: true,
            header: true,
            complete: function(results) {
                results.data.forEach(row => {
                    table.row.add([
                        row['Property Class'], row['Sale Date'], row['Sale Price'], row['SqFt'],
                        row['Sale Price per SqFt'], row['Sale Price Time Adj'], row['Style'],
                        row['Year Built'], row['Acreage'], row['Bedrooms'], row['Baths']
                    ]);
                });
                table.draw();
                createFilters();
                updateFooter();
            }
        });
    }

    function createFilters() {
        $('#salesTable thead th').each(function(i) {
            const title = $(this).text();
            const column = table.column(i);
            const input = $('<div class="col-md-2"><label>' + title + '</label></div>').appendTo('#filters');

            if (title.includes('Date')) {
                $('<input type="date" class="form-control">').appendTo(input).on('change', applyFilters);
                $('<input type="date" class="form-control mt-1">').appendTo(input).on('change', applyFilters);
            } else if (title.match(/Price|SqFt|Acreage|Year Built|per SqFt/)) {
                $('<input type="number" class="form-control" placeholder="Min">').appendTo(input).on('input', applyFilters);
                $('<input type="number" class="form-control mt-1" placeholder="Max">').appendTo(input).on('input', applyFilters);
            } else {
                const select = $('<select class="form-control" multiple></select>').appendTo(input);
                column.data().unique().sort().each(function(d) {
                    select.append('<option value="'+d+'">'+d+'</option>');
                });
                select.on('change', applyFilters);
            }
        });
    }

    function applyFilters() {
        table.draw();
        updateFooter();
    }

    function updateFooter() {
        const totalRows = table.rows({search:'applied'}).count();
        $('#rowCount').text(totalRows);
        const avgPrice = table.column(2, {search:'applied'}).data().reduce((a, b) => parseFloat(a) + parseFloat(b), 0) / totalRows;
        $('#avgPrice').text(avgPrice.toFixed(2));
    }

    loadCSVData();
});
</script>
</body>
</html>
